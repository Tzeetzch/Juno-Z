@page "/login/child"
@using JunoBank.Web.Components.Shared
@using JunoBank.Web.Services

<PageTitle>Kid Login - Juno Bank</PageTitle>

<div style="max-width: 400px; margin: 2rem auto; text-align: center;">
    <MudText Typo="Typo.h4" Class="mb-2">Hi there!</MudText>
    <MudText Typo="Typo.body1" Class="mb-6">Tap your secret pictures</MudText>

    <PictureGrid @ref="_pictureGrid"
                 RequiredLength="4"
                 OnSequenceComplete="HandleSequenceComplete" />

    <MudButton Variant="Variant.Text"
               Color="Color.Secondary"
               Class="mt-6"
               OnClick="GoBack">
        ‚Üê Back
    </MudButton>
</div>

@code {
    [Inject] private IAuthService AuthService { get; set; } = default!;
    [Inject] private NavigationManager Navigation { get; set; } = default!;

    private PictureGrid? _pictureGrid;

    private async Task HandleSequenceComplete(string[] sequence)
    {
        var result = await AuthService.AuthenticateChildAsync(sequence);

        if (result.Success)
        {
            Navigation.NavigateTo("/child");
        }
        else
        {
            _pictureGrid?.ShowError(result.Error ?? "Authentication failed");
        }
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/login");
    }
}
