@page "/parent/settings"
@attribute [Authorize(Roles = "Parent")]
@using JunoBank.Web.Services
@inject IUserService UserService
@inject NavigationManager Navigation

<PageTitle>Settings</PageTitle>

<div style="max-width: 600px; margin: 0 auto; padding: 2rem;">

    <MudButton Variant="Variant.Text" Color="Color.Default" OnClick="@(() => Navigation.NavigateTo("/parent"))">
        ← Back to Dashboard
    </MudButton>

    <MudText Typo="Typo.h4" Style="margin: 1rem 0 2rem;">
        ⚙️ Settings
    </MudText>

    <MudAlert Severity="Severity.Info" Class="mb-4">
        Settings are now managed per child. Select a child below to configure their allowance.
    </MudAlert>

    @if (_isLoading)
    {
        <MudProgressCircular Indeterminate="true" Size="Size.Large" />
    }
    else
    {
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            @foreach (var child in _children)
            {
                <MudButton Variant="Variant.Outlined"
                           Color="Color.Primary"
                           Size="Size.Large"
                           FullWidth="true"
                           OnClick="@(() => Navigation.NavigateTo($"/parent/child/{child.Id}/settings"))">
                    ⚙️ @child.Name's Settings
                </MudButton>
            }
        </div>
    }
</div>

@code {
    private bool _isLoading = true;
    private List<ChildSummary> _children = new();

    protected override async Task OnInitializedAsync()
    {
        _children = await UserService.GetAllChildrenSummaryAsync();
        _isLoading = false;
    }
}
