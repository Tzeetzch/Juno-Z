@page "/parent/history"
@attribute [Authorize(Roles = "Parent")]
@using JunoBank.Web.Auth
@using JunoBank.Web.Data.Entities
@using JunoBank.Web.Services
@using JunoBank.Web.Components.Shared
@inject CustomAuthStateProvider AuthProvider
@inject IUserService UserService
@inject NavigationManager Navigation

<PageTitle>Transaction History</PageTitle>

<div style="max-width: 700px; margin: 0 auto; padding: 2rem;">

    <MudButton Variant="Variant.Text" Color="Color.Default" OnClick="@(() => Navigation.NavigateTo("/parent"))">
        ‚Üê Back to Dashboard
    </MudButton>

    <MudText Typo="Typo.h4" Style="margin: 1rem 0 2rem;">
        üìú Transaction History
    </MudText>

    @if (_isLoading)
    {
        <MudProgressCircular Indeterminate="true" Size="Size.Large" />
    }
    else
    {
        <TransactionList Transactions="_transactions" />
    }
</div>

@code {
    private List<Transaction> _transactions = new();
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        var session = await AuthProvider.GetCurrentUserAsync();
        if (session == null || session.Role != UserRole.Parent)
        {
            Navigation.NavigateTo("/");
            return;
        }

        _transactions = await UserService.GetAllTransactionsAsync();
        _isLoading = false;
    }
}
